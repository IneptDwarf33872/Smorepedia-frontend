{"ast":null,"code":"/*-\n * Copyright (c) 2018, 2024 Oracle and/or its affiliates. All rights reserved.\n *\n * Licensed under the Universal Permissive License v 1.0 as shown at\n *  https://oss.oracle.com/licenses/upl/\n */\n\nconst assert = require('assert');\nconst os = require('os');\nconst path = require('path');\nconst fsPromises = require('fs').promises;\nconst clearData = require('../../utils').clearData;\nconst readProfileSync = require('../../utils').readProfileSync;\nconst requireNoWP = require('../../utils').requireNoWP;\nconst NoSQLArgumentError = require('../../error').NoSQLArgumentError;\nconst NoSQLAuthorizationError = require('../../error').NoSQLAuthorizationError;\nconst Utils = require('./utils');\nconst DEFAULT_PROFILE_NAME = 'DEFAULT';\nconst FINGERPRINT_PROP = 'fingerprint';\nconst TENANCY_PROP = 'tenancy';\nconst USER_PROP = 'user';\nconst KEY_FILE_PROP = 'key_file';\nconst PASSPHRASE_PROP = 'pass_phrase';\nconst REGION_PROP = 'region';\nconst SESS_TOKEN_FILE_PROP = 'security_token_file';\n\n//Credentials sources, only for error reporing.\nconst AUTH_IAM_CONFIG = 'auth.iam section of the configuration';\nconst CREDS_PROVIDER_CREDS = 'credentials from credentials provider';\nclass IAMProfileProvider {\n  //creds contains required IAM credentials\n  //cfg and credsSource are only for error reporing\n  _initFromCreds(creds, cfg, credsSource) {\n    assert(creds != null);\n    if (creds.tenantId == null) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"tenantId\\\" in \".concat(credsSource), cfg);\n    }\n    if (!Utils.isValidOcid(creds.tenantId)) {\n      throw new NoSQLArgumentError(\"Property \\\"tenantId\\\" in \".concat(credsSource, \" is not a valid OCID: \").concat(creds.tenantId));\n    }\n    this._tenantId = creds.tenantId;\n    if (creds.userId == null) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"userId\\\" in \".concat(credsSource), cfg);\n    }\n    if (!Utils.isValidOcid(creds.userId)) {\n      throw new NoSQLArgumentError(\"Property \\\"userId\\\" in \".concat(credsSource, \" is not a valid OCID: \").concat(creds.userId), cfg);\n    }\n    this._userId = creds.userId;\n    if (creds.fingerprint == null) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"fingerprint\\\" in \".concat(credsSource), cfg);\n    }\n    if (typeof creds.fingerprint !== 'string' || !creds.fingerprint.length) {\n      throw new NoSQLArgumentError(\"Invalid value for property \\\"fingerprint\\\" in \".concat(credsSource, \": \").concat(creds.fingerprint), cfg);\n    }\n    this._fingerprint = creds.fingerprint;\n    this._keyId = \"\".concat(this._tenantId, \"/\").concat(this._userId, \"/\").concat(this._fingerprint);\n    if (creds.privateKeyFile != null) {\n      if (typeof creds.privateKeyFile !== 'string' && !Buffer.isBuffer(creds.privateKeyFile)) {\n        throw new NoSQLArgumentError(\"Invalid value for property \\\"privateKeyFile\\\" in \".concat(credsSource, \": \").concat(creds.privateKeyFile), cfg);\n      }\n      if (creds.privateKey != null) {\n        throw new NoSQLArgumentError(\"May not specify both properties \\\"privateKeyFile\\\" and \\\"privateKey\\\" in \".concat(credsSource), cfg);\n      }\n      this._pkFile = creds.privateKeyFile;\n    } else {\n      if (creds.privateKey == null) {\n        throw new NoSQLArgumentError(\"Missing both properties \\\"privateKeyFile\\\" and \\\"privateKey\\\" in \".concat(credsSource), cfg);\n      }\n      if (typeof creds.privateKey !== 'string' && !Buffer.isBuffer(creds.privateKey)) {\n        throw new NoSQLArgumentError(\"Invalid value for property \\\"privateKey\\\" in \".concat(credsSource, \": \").concat(creds.privateKey), cfg);\n      }\n      this._pkData = creds.privateKey;\n    }\n    if (creds.passphrase != null) {\n      if (typeof creds.passphrase !== 'string' && !Buffer.isBuffer(creds.passphrase)) {\n        throw new NoSQLArgumentError(\"Invalid value for property \\\"passphrase\\\" in \".concat(credsSource, \": \").concat(creds.passphrase), cfg);\n      }\n      this._passphrase = creds.passphrase;\n    }\n  }\n  _initFromOCIConfig(profile, cfg) {\n    assert(profile != null && profile._ociConfigSrc);\n    if (!profile[TENANCY_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(TENANCY_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    if (!Utils.isValidOcid(profile[TENANCY_PROP])) {\n      throw new NoSQLArgumentError(\"Property \\\"\".concat(TENANCY_PROP, \"\\\" in \").concat(profile._ociConfigSrc, \" is not a valid OCID: \").concat(profile[TENANCY_PROP]), cfg);\n    }\n    this._tenantId = profile[TENANCY_PROP];\n    if (!profile[USER_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(USER_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    if (!Utils.isValidOcid(profile[USER_PROP])) {\n      throw new NoSQLArgumentError(\"Property \\\"\".concat(USER_PROP, \"\\\" in \\\"\").concat(profile._ociConfigSrc, \"\\\" is not a valid OCID: \").concat(profile[USER_PROP]), cfg);\n    }\n    this._userId = profile[USER_PROP];\n    if (!profile[FINGERPRINT_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(KEY_FILE_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    this._fingerprint = profile[FINGERPRINT_PROP];\n    this._keyId = \"\".concat(this._tenantId, \"/\").concat(this._userId, \"/\").concat(this._fingerprint);\n    if (!profile[KEY_FILE_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(KEY_FILE_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    this._pkFile = profile[KEY_FILE_PROP];\n    if (profile[PASSPHRASE_PROP]) {\n      this._passphrase = profile[PASSPHRASE_PROP];\n    }\n  }\n  constructor(creds, cfg) {\n    if (creds._ociConfigSrc) {\n      this._initFromOCIConfig(creds, cfg);\n    } else {\n      this._initFromCreds(creds, cfg, creds._fromCredsProvider ? CREDS_PROVIDER_CREDS : AUTH_IAM_CONFIG);\n    }\n  }\n  async _initPrivateKey() {\n    if (this._pkFile != null) {\n      this._privateKey = await Utils.privateKeyFromPEMFile(this._pkFile, this._passphrase);\n    } else {\n      this._privateKey = Utils.privateKeyFromPEM(this._pkData, this._passphrase);\n    }\n  }\n  async getProfile() {\n    if (this._privateKey == null) {\n      await this._initPrivateKey();\n    }\n    return {\n      keyId: this._keyId,\n      privateKey: this._privateKey,\n      tenantId: this._tenantId\n    };\n  }\n  close() {\n    //Ideally this._privateKey should be cleared as well, but cryto\n    //module does not currently have such API\n    clearData(this._passprase);\n  }\n}\nclass SessTokenProfileProvider {\n  constructor(profile, cfg) {\n    assert(profile != null && profile._ociConfigSrc);\n    if (!profile[TENANCY_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(TENANCY_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    if (!Utils.isValidOcid(profile[TENANCY_PROP])) {\n      throw new NoSQLArgumentError(\"Property \\\"\".concat(TENANCY_PROP, \"\\\" in \").concat(profile._ociConfigSrc, \" is not a valid OCID: \").concat(profile[TENANCY_PROP]), cfg);\n    }\n    this._tenantId = profile[TENANCY_PROP];\n    if (!profile[KEY_FILE_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(KEY_FILE_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    this._pkFile = profile[KEY_FILE_PROP];\n    if (profile[PASSPHRASE_PROP]) {\n      this._passphrase = profile[PASSPHRASE_PROP];\n    }\n    if (!profile[SESS_TOKEN_FILE_PROP]) {\n      throw new NoSQLArgumentError(\"Missing required property \\\"\".concat(SESS_TOKEN_FILE_PROP, \"\\\" in \").concat(profile._ociConfigSrc), cfg);\n    }\n    this._sessTokenFile = profile[SESS_TOKEN_FILE_PROP];\n  }\n  async _initPrivateKey() {\n    if (this._pkFile != null) {\n      this._privateKey = await Utils.privateKeyFromPEMFile(this._pkFile, this._passphrase);\n    } else {\n      this._privateKey = Utils.privateKeyFromPEM(this._pkData, this._passphrase);\n    }\n  }\n  async _readSessToken() {\n    let data;\n    try {\n      data = await fsPromises.readFile(this._sessTokenFile, 'utf8');\n    } catch (err) {\n      throw NoSQLAuthorizationError.invalidArg(\"Error retrieving security token from file \".concat(this._sessTokenFile, \": \").concat(err.message), err);\n    }\n    data = data.replace(/\\r?\\n/g, '');\n    if (!data) {\n      throw NoSQLAuthorizationError.invalidArg(\"Security token from file \".concat(this._sessTokenFile, \" is empty\"));\n    }\n    return data;\n  }\n  async getProfile() {\n    if (this._privateKey == null) {\n      await this._initPrivateKey();\n    }\n    const token = await this._readSessToken();\n    return {\n      keyId: 'ST$' + token,\n      privateKey: this._privateKey,\n      tenantId: this._tenantId\n    };\n  }\n  close() {\n    clearData(this._passprase);\n  }\n}\nclass OCIConfigFileProvider {\n  constructor(opt, cfg) {\n    let providerCons = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : IAMProfileProvider;\n    assert(opt != null);\n    let configFile;\n    let profileName;\n    if (opt.configFile != null) {\n      if (typeof opt.configFile !== 'string' && !Buffer.isBuffer(opt.configFile)) {\n        throw new NoSQLArgumentError(\"Invalid value for auth.iam.configFile: \".concat(opt.configFile), cfg);\n      }\n      configFile = opt.configFile;\n    } else {\n      configFile = path.join(os.homedir(), '.oci', 'config');\n    }\n    if (opt.profileName != null) {\n      if (typeof opt.profileName !== 'string') {\n        throw new NoSQLArgumentError(\"Invalid value for auth.iam.profileName: \".concat(opt.profileName), cfg);\n      }\n      profileName = opt.profileName;\n    } else {\n      profileName = DEFAULT_PROFILE_NAME;\n    }\n    assert(providerCons != null);\n    this._providerCons = providerCons;\n\n    //Change to read oci config file only once in the constructor\n    const profile = this._getProfileSync(configFile, profileName, cfg);\n    this._provider = new providerCons(profile, cfg);\n    if (profile[REGION_PROP]) {\n      this._region = profile[REGION_PROP];\n    }\n  }\n  _getProfileSync(configFile, profileName, cfg) {\n    let profile;\n    try {\n      profile = readProfileSync(configFile, profileName);\n    } catch (err) {\n      throw NoSQLAuthorizationError.invalidArg(\"Error retrieving profile \".concat(profileName, \" from config file \").concat(configFile), err, cfg);\n    }\n    if (profile == null) {\n      throw NoSQLAuthorizationError.invalidArg(\"Cannot find profile \\\"\".concat(profileName, \"\\\" in config file \").concat(configFile), null, cfg);\n    }\n    profile._ociConfigSrc = \"OCI config file \\\"\".concat(configFile, \"\\\", profile \\\"\").concat(profileName, \"\\\"\");\n    return profile;\n  }\n  getProfile() {\n    assert(this._provider != null);\n    return this._provider.getProfile();\n  }\n  getRegion() {\n    return this._region;\n  }\n  close() {\n    if (this._provider != null) {\n      this._provider.close();\n    }\n  }\n}\nclass UserProfileProvider {\n  constructor(opt, cfg) {\n    assert(opt != null && 'credentialsProvider' in opt);\n    let credsProvider = opt.credentialsProvider;\n    if (typeof credsProvider === 'string') {\n      try {\n        credsProvider = requireNoWP(credsProvider);\n      } catch (err) {\n        throw new NoSQLArgumentError(\"Error loading credentials provider from module \\\"\".concat(credsProvider, \"\\\"\"), cfg, err);\n      }\n    }\n    if (typeof credsProvider === 'object' && credsProvider != null) {\n      if (typeof credsProvider.loadCredentials !== 'function') {\n        throw new NoSQLArgumentError('Invalid value of \\\nauth.iam.credentialsProvider: does not contain loadCredentials method', cfg);\n      }\n      this._credsProvider = credsProvider;\n    } else if (typeof credsProvider === 'function') {\n      this._credsProvider = {\n        loadCredentials: credsProvider\n      };\n    } else {\n      throw new NoSQLArgumentError(\"Invalid value of auth.iam.credentialsProvider: \".concat(credsProvider), cfg);\n    }\n  }\n  async getProfile() {\n    let creds;\n    try {\n      creds = await this._credsProvider.loadCredentials();\n    } catch (err) {\n      throw NoSQLAuthorizationError.invalidArg('Error retrieving \\\ncredentials', err);\n    }\n    if (creds == null || typeof creds !== 'object') {\n      throw NoSQLAuthorizationError.invalidArg('Retrieved credentials \\\nare missing or invalid');\n    }\n    creds._fromCredsProvider = true;\n    let provider;\n    try {\n      provider = new IAMProfileProvider(creds);\n      return provider.getProfile();\n    } finally {\n      if (provider != null) {\n        provider.close();\n      }\n    }\n  }\n}\nmodule.exports = {\n  IAMProfileProvider,\n  SessTokenProfileProvider,\n  OCIConfigFileProvider,\n  UserProfileProvider\n};","map":{"version":3,"names":["assert","require","os","path","fsPromises","promises","clearData","readProfileSync","requireNoWP","NoSQLArgumentError","NoSQLAuthorizationError","Utils","DEFAULT_PROFILE_NAME","FINGERPRINT_PROP","TENANCY_PROP","USER_PROP","KEY_FILE_PROP","PASSPHRASE_PROP","REGION_PROP","SESS_TOKEN_FILE_PROP","AUTH_IAM_CONFIG","CREDS_PROVIDER_CREDS","IAMProfileProvider","_initFromCreds","creds","cfg","credsSource","tenantId","concat","isValidOcid","_tenantId","userId","_userId","fingerprint","length","_fingerprint","_keyId","privateKeyFile","Buffer","isBuffer","privateKey","_pkFile","_pkData","passphrase","_passphrase","_initFromOCIConfig","profile","_ociConfigSrc","constructor","_fromCredsProvider","_initPrivateKey","_privateKey","privateKeyFromPEMFile","privateKeyFromPEM","getProfile","keyId","close","_passprase","SessTokenProfileProvider","_sessTokenFile","_readSessToken","data","readFile","err","invalidArg","message","replace","token","OCIConfigFileProvider","opt","providerCons","arguments","undefined","configFile","profileName","join","homedir","_providerCons","_getProfileSync","_provider","_region","getRegion","UserProfileProvider","credsProvider","credentialsProvider","loadCredentials","_credsProvider","provider","module","exports"],"sources":["C:/Users/teddy/Desktop/VSCodeProjects/Smorepedia/smoresapp/node_modules/oracle-nosqldb/lib/auth/iam/profile.js"],"sourcesContent":["/*-\n * Copyright (c) 2018, 2024 Oracle and/or its affiliates. All rights reserved.\n *\n * Licensed under the Universal Permissive License v 1.0 as shown at\n *  https://oss.oracle.com/licenses/upl/\n */\n\nconst assert = require('assert');\nconst os = require('os');\nconst path = require('path');\nconst fsPromises = require('fs').promises;\n\nconst clearData = require('../../utils').clearData;\nconst readProfileSync = require('../../utils').readProfileSync;\nconst requireNoWP = require('../../utils').requireNoWP;\nconst NoSQLArgumentError = require('../../error').NoSQLArgumentError;\nconst NoSQLAuthorizationError =\n    require('../../error').NoSQLAuthorizationError;\nconst Utils = require('./utils');\n\nconst DEFAULT_PROFILE_NAME = 'DEFAULT';\nconst FINGERPRINT_PROP = 'fingerprint';\nconst TENANCY_PROP = 'tenancy';\nconst USER_PROP = 'user';\nconst KEY_FILE_PROP = 'key_file';\nconst PASSPHRASE_PROP = 'pass_phrase';\nconst REGION_PROP = 'region';\nconst SESS_TOKEN_FILE_PROP = 'security_token_file';\n\n//Credentials sources, only for error reporing.\nconst AUTH_IAM_CONFIG = 'auth.iam section of the configuration';\nconst CREDS_PROVIDER_CREDS = 'credentials from credentials provider';\n\nclass IAMProfileProvider {\n\n    //creds contains required IAM credentials\n    //cfg and credsSource are only for error reporing\n    _initFromCreds(creds, cfg, credsSource) {\n        assert(creds != null);\n\n        if (creds.tenantId == null) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"tenantId\" in ${credsSource}`,\n                cfg);\n        }\n        if (!Utils.isValidOcid(creds.tenantId)) {\n            throw new NoSQLArgumentError(\n                `Property \"tenantId\" in ${credsSource} is not a valid OCID: \\\n${creds.tenantId}`);\n        }\n        this._tenantId = creds.tenantId;\n\n        if (creds.userId == null) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"userId\" in ${credsSource}`, cfg);\n        }\n        if (!Utils.isValidOcid(creds.userId)) {\n            throw new NoSQLArgumentError(\n                `Property \"userId\" in ${credsSource} is not a valid OCID: \\\n${creds.userId}`, cfg);\n        }\n        this._userId = creds.userId;\n\n        if (creds.fingerprint == null) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"fingerprint\" in ${credsSource}`,\n                cfg);\n        }\n        if (typeof creds.fingerprint !== 'string' ||\n            !creds.fingerprint.length) {\n            throw new NoSQLArgumentError(\n                `Invalid value for property \"fingerprint\" in ${credsSource}: \\\n${creds.fingerprint}`, cfg);\n        }\n        this._fingerprint = creds.fingerprint;\n\n        this._keyId =\n            `${this._tenantId}/${this._userId}/${this._fingerprint}`;\n\n        if (creds.privateKeyFile != null) {\n            if (typeof creds.privateKeyFile !== 'string' &&\n                !Buffer.isBuffer(creds.privateKeyFile)) {\n                throw new NoSQLArgumentError(\n                    `Invalid value for property \"privateKeyFile\" in \\\n${credsSource}: ${creds.privateKeyFile}`, cfg);\n            }\n            if (creds.privateKey != null) {\n                throw new NoSQLArgumentError(\n                    `May not specify both properties \"privateKeyFile\" and \\\n\"privateKey\" in ${credsSource}`, cfg);\n            }\n            this._pkFile = creds.privateKeyFile;\n        } else {\n            if (creds.privateKey == null) {\n                throw new NoSQLArgumentError(\n                    `Missing both properties \"privateKeyFile\" and \\\n\"privateKey\" in ${credsSource}`, cfg);\n            }\n            if (typeof creds.privateKey !== 'string' &&\n                !Buffer.isBuffer(creds.privateKey)) {\n                throw new NoSQLArgumentError(`Invalid value for property \\\n\"privateKey\" in ${credsSource}: ${creds.privateKey}`, cfg);\n            }\n            this._pkData = creds.privateKey;\n        }\n        if (creds.passphrase != null) {\n            if (typeof creds.passphrase !== 'string' &&\n                !Buffer.isBuffer(creds.passphrase)) {\n                throw new NoSQLArgumentError(\n                    `Invalid value for property \"passphrase\" in \\\n${credsSource}: ${creds.passphrase}`, cfg);\n            }\n            this._passphrase = creds.passphrase;\n        }\n    }\n\n    _initFromOCIConfig(profile, cfg) {\n        assert(profile != null && profile._ociConfigSrc);\n        \n        if (!profile[TENANCY_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${TENANCY_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        if (!Utils.isValidOcid(profile[TENANCY_PROP])) {\n            throw new NoSQLArgumentError(\n                `Property \"${TENANCY_PROP}\" in ${profile._ociConfigSrc} is \\\nnot a valid OCID: ${profile[TENANCY_PROP]}`, cfg);\n        }\n        this._tenantId = profile[TENANCY_PROP];\n\n        if (!profile[USER_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${USER_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        if (!Utils.isValidOcid(profile[USER_PROP])) {\n            throw new NoSQLArgumentError(\n                `Property \"${USER_PROP}\" in \"${profile._ociConfigSrc}\" is \\\nnot a valid OCID: ${profile[USER_PROP]}`, cfg);\n        }\n        this._userId = profile[USER_PROP];\n\n        if (!profile[FINGERPRINT_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${KEY_FILE_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        this._fingerprint = profile[FINGERPRINT_PROP];\n\n        this._keyId =\n            `${this._tenantId}/${this._userId}/${this._fingerprint}`;\n            \n        if (!profile[KEY_FILE_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${KEY_FILE_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        this._pkFile = profile[KEY_FILE_PROP];\n\n        if (profile[PASSPHRASE_PROP]) {\n            this._passphrase = profile[PASSPHRASE_PROP];\n        }\n    }\n\n    constructor(creds, cfg) {\n        if (creds._ociConfigSrc) {\n            this._initFromOCIConfig(creds, cfg);\n        } else {\n            this._initFromCreds(creds, cfg, creds._fromCredsProvider ?\n                CREDS_PROVIDER_CREDS : AUTH_IAM_CONFIG);\n        }\n    }\n\n    async _initPrivateKey() {\n        if (this._pkFile != null) {\n            this._privateKey = await Utils.privateKeyFromPEMFile(this._pkFile,\n                this._passphrase);\n        } else {\n            this._privateKey = Utils.privateKeyFromPEM(this._pkData,\n                this._passphrase);\n        }\n    }\n\n    async getProfile() {\n        if (this._privateKey == null) {\n            await this._initPrivateKey();\n        }\n        return {\n            keyId: this._keyId,\n            privateKey: this._privateKey,\n            tenantId: this._tenantId\n        };\n    }\n\n    close() {\n        //Ideally this._privateKey should be cleared as well, but cryto\n        //module does not currently have such API\n        clearData(this._passprase);\n    }\n\n}\n\nclass SessTokenProfileProvider {\n\n    constructor(profile, cfg) {\n        assert(profile != null && profile._ociConfigSrc);\n\n        if (!profile[TENANCY_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${TENANCY_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        if (!Utils.isValidOcid(profile[TENANCY_PROP])) {\n            throw new NoSQLArgumentError(\n                `Property \"${TENANCY_PROP}\" in ${profile._ociConfigSrc} is \\\nnot a valid OCID: ${profile[TENANCY_PROP]}`, cfg);\n        }\n        this._tenantId = profile[TENANCY_PROP];\n\n        if (!profile[KEY_FILE_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${KEY_FILE_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        this._pkFile = profile[KEY_FILE_PROP];\n\n        if (profile[PASSPHRASE_PROP]) {\n            this._passphrase = profile[PASSPHRASE_PROP];\n        }\n\n        if (!profile[SESS_TOKEN_FILE_PROP]) {\n            throw new NoSQLArgumentError(\n                `Missing required property \"${SESS_TOKEN_FILE_PROP}\" in \\\n${profile._ociConfigSrc}`, cfg);\n        }\n        this._sessTokenFile = profile[SESS_TOKEN_FILE_PROP];\n    }\n\n    async _initPrivateKey() {\n        if (this._pkFile != null) {\n            this._privateKey = await Utils.privateKeyFromPEMFile(this._pkFile,\n                this._passphrase);\n        } else {\n            this._privateKey = Utils.privateKeyFromPEM(this._pkData,\n                this._passphrase);\n        }\n    }\n\n    async _readSessToken() {\n        let data;\n        try {\n            data = await fsPromises.readFile(this._sessTokenFile, 'utf8');\n        } catch(err) {\n            throw NoSQLAuthorizationError.invalidArg(\n                `Error retrieving security token from file \\\n${this._sessTokenFile}: ${err.message}`, err);\n        }\n        data = data.replace(/\\r?\\n/g, '');\n        if (!data) {\n            throw NoSQLAuthorizationError.invalidArg(\n                `Security token from file ${this._sessTokenFile} is empty`);\n        }\n        return data;\n    }\n\n    async getProfile() {\n        if (this._privateKey == null) {\n            await this._initPrivateKey();\n        }\n        const token = await this._readSessToken();\n        return {\n            keyId: 'ST$' + token,\n            privateKey: this._privateKey,\n            tenantId: this._tenantId\n        };\n    }\n\n    close() {\n        clearData(this._passprase);\n    }\n\n}\n\nclass OCIConfigFileProvider {\n\n    constructor(opt, cfg, providerCons = IAMProfileProvider) {\n        assert(opt != null);\n        let configFile;\n        let profileName;\n\n        if (opt.configFile != null) {\n            if (typeof opt.configFile !== 'string' &&\n                !Buffer.isBuffer(opt.configFile)) {\n                throw new NoSQLArgumentError(`Invalid value for \\\nauth.iam.configFile: ${opt.configFile}`, cfg);\n            }\n            configFile = opt.configFile;\n        } else {\n            configFile = path.join(os.homedir(), '.oci', 'config');\n        }\n        if (opt.profileName != null) {\n            if (typeof opt.profileName !== 'string') {\n                throw new NoSQLArgumentError(`Invalid value for \\\nauth.iam.profileName: ${opt.profileName}`, cfg);\n            }\n            profileName = opt.profileName;\n        } else {\n            profileName = DEFAULT_PROFILE_NAME;\n        }\n\n        assert(providerCons != null);\n        this._providerCons = providerCons;\n        \n        //Change to read oci config file only once in the constructor\n        const profile = this._getProfileSync(configFile, profileName, cfg);\n        this._provider = new providerCons(profile, cfg);\n        if (profile[REGION_PROP]) {\n            this._region = profile[REGION_PROP];\n        }\n    }\n\n    _getProfileSync(configFile, profileName, cfg) {\n        let profile;\n        try {\n            profile = readProfileSync(configFile, profileName);\n        } catch(err) {\n            throw NoSQLAuthorizationError.invalidArg(`Error retrieving \\\nprofile ${profileName} from config file ${configFile}`, err, cfg);\n        }\n        if (profile == null) {\n            throw NoSQLAuthorizationError.invalidArg(`Cannot find profile \\\n\"${profileName}\" in config file ${configFile}`, null, cfg);\n        }\n\n        profile._ociConfigSrc = `OCI config file \"${configFile}\", \\\nprofile \"${profileName}\"`;\n        return profile;\n    }\n\n    getProfile() {\n        assert(this._provider != null);\n        return this._provider.getProfile();\n    }\n\n    getRegion() {\n        return this._region;\n    }\n\n    close() {\n        if (this._provider != null) {\n            this._provider.close();\n        }\n    }\n}\n\nclass UserProfileProvider {\n\n    constructor(opt, cfg) {\n        assert (opt != null && 'credentialsProvider' in opt);\n        let credsProvider = opt.credentialsProvider;\n        if (typeof credsProvider === 'string') {\n            try {\n                credsProvider = requireNoWP(credsProvider);\n            } catch(err) {\n                throw new NoSQLArgumentError(`Error loading credentials \\\nprovider from module \"${credsProvider}\"`, cfg, err);\n            }\n        }\n        if (typeof credsProvider === 'object' && credsProvider != null) {\n            if (typeof credsProvider.loadCredentials !== 'function') {\n                throw new NoSQLArgumentError('Invalid value of \\\nauth.iam.credentialsProvider: does not contain loadCredentials method', cfg);\n            }\n            this._credsProvider = credsProvider;\n        } else if (typeof credsProvider === 'function') {\n            this._credsProvider = { loadCredentials: credsProvider };\n        } else {\n            throw new NoSQLArgumentError(`Invalid value of \\\nauth.iam.credentialsProvider: ${credsProvider}`, cfg);\n        }\n    }\n\n    async getProfile() {\n        let creds;\n        try {\n            creds = await this._credsProvider.loadCredentials();\n        } catch(err) {\n            throw NoSQLAuthorizationError.invalidArg('Error retrieving \\\ncredentials', err);\n        }\n        if (creds == null || typeof creds !== 'object') {\n            throw NoSQLAuthorizationError.invalidArg('Retrieved credentials \\\nare missing or invalid');\n        }\n        creds._fromCredsProvider = true;\n\n        let provider;\n        try {\n            provider = new IAMProfileProvider(creds);\n            return provider.getProfile();\n        } finally {\n            if (provider != null) {\n                provider.close();\n            }\n        }\n    }\n\n}\n\nmodule.exports = {\n    IAMProfileProvider,\n    SessTokenProfileProvider,\n    OCIConfigFileProvider,\n    UserProfileProvider\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;;AAEA,MAAMA,MAAM,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAChC,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC;AACxB,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMG,UAAU,GAAGH,OAAO,CAAC,IAAI,CAAC,CAACI,QAAQ;AAEzC,MAAMC,SAAS,GAAGL,OAAO,CAAC,aAAa,CAAC,CAACK,SAAS;AAClD,MAAMC,eAAe,GAAGN,OAAO,CAAC,aAAa,CAAC,CAACM,eAAe;AAC9D,MAAMC,WAAW,GAAGP,OAAO,CAAC,aAAa,CAAC,CAACO,WAAW;AACtD,MAAMC,kBAAkB,GAAGR,OAAO,CAAC,aAAa,CAAC,CAACQ,kBAAkB;AACpE,MAAMC,uBAAuB,GACzBT,OAAO,CAAC,aAAa,CAAC,CAACS,uBAAuB;AAClD,MAAMC,KAAK,GAAGV,OAAO,CAAC,SAAS,CAAC;AAEhC,MAAMW,oBAAoB,GAAG,SAAS;AACtC,MAAMC,gBAAgB,GAAG,aAAa;AACtC,MAAMC,YAAY,GAAG,SAAS;AAC9B,MAAMC,SAAS,GAAG,MAAM;AACxB,MAAMC,aAAa,GAAG,UAAU;AAChC,MAAMC,eAAe,GAAG,aAAa;AACrC,MAAMC,WAAW,GAAG,QAAQ;AAC5B,MAAMC,oBAAoB,GAAG,qBAAqB;;AAElD;AACA,MAAMC,eAAe,GAAG,uCAAuC;AAC/D,MAAMC,oBAAoB,GAAG,uCAAuC;AAEpE,MAAMC,kBAAkB,CAAC;EAErB;EACA;EACAC,cAAcA,CAACC,KAAK,EAAEC,GAAG,EAAEC,WAAW,EAAE;IACpC1B,MAAM,CAACwB,KAAK,IAAI,IAAI,CAAC;IAErB,IAAIA,KAAK,CAACG,QAAQ,IAAI,IAAI,EAAE;MACxB,MAAM,IAAIlB,kBAAkB,8CAAAmB,MAAA,CACmBF,WAAW,GACtDD,GAAG,CAAC;IACZ;IACA,IAAI,CAACd,KAAK,CAACkB,WAAW,CAACL,KAAK,CAACG,QAAQ,CAAC,EAAE;MACpC,MAAM,IAAIlB,kBAAkB,6BAAAmB,MAAA,CACEF,WAAW,4BAAAE,MAAA,CACnDJ,KAAK,CAACG,QAAQ,CAAE,CAAC;IACX;IACA,IAAI,CAACG,SAAS,GAAGN,KAAK,CAACG,QAAQ;IAE/B,IAAIH,KAAK,CAACO,MAAM,IAAI,IAAI,EAAE;MACtB,MAAM,IAAItB,kBAAkB,4CAAAmB,MAAA,CACiBF,WAAW,GAAID,GAAG,CAAC;IACpE;IACA,IAAI,CAACd,KAAK,CAACkB,WAAW,CAACL,KAAK,CAACO,MAAM,CAAC,EAAE;MAClC,MAAM,IAAItB,kBAAkB,2BAAAmB,MAAA,CACAF,WAAW,4BAAAE,MAAA,CACjDJ,KAAK,CAACO,MAAM,GAAIN,GAAG,CAAC;IACd;IACA,IAAI,CAACO,OAAO,GAAGR,KAAK,CAACO,MAAM;IAE3B,IAAIP,KAAK,CAACS,WAAW,IAAI,IAAI,EAAE;MAC3B,MAAM,IAAIxB,kBAAkB,iDAAAmB,MAAA,CACsBF,WAAW,GACzDD,GAAG,CAAC;IACZ;IACA,IAAI,OAAOD,KAAK,CAACS,WAAW,KAAK,QAAQ,IACrC,CAACT,KAAK,CAACS,WAAW,CAACC,MAAM,EAAE;MAC3B,MAAM,IAAIzB,kBAAkB,kDAAAmB,MAAA,CACuBF,WAAW,QAAAE,MAAA,CACxEJ,KAAK,CAACS,WAAW,GAAIR,GAAG,CAAC;IACnB;IACA,IAAI,CAACU,YAAY,GAAGX,KAAK,CAACS,WAAW;IAErC,IAAI,CAACG,MAAM,MAAAR,MAAA,CACJ,IAAI,CAACE,SAAS,OAAAF,MAAA,CAAI,IAAI,CAACI,OAAO,OAAAJ,MAAA,CAAI,IAAI,CAACO,YAAY,CAAE;IAE5D,IAAIX,KAAK,CAACa,cAAc,IAAI,IAAI,EAAE;MAC9B,IAAI,OAAOb,KAAK,CAACa,cAAc,KAAK,QAAQ,IACxC,CAACC,MAAM,CAACC,QAAQ,CAACf,KAAK,CAACa,cAAc,CAAC,EAAE;QACxC,MAAM,IAAI5B,kBAAkB,qDAAAmB,MAAA,CAE1CF,WAAW,QAAAE,MAAA,CAAKJ,KAAK,CAACa,cAAc,GAAIZ,GAAG,CAAC;MAClC;MACA,IAAID,KAAK,CAACgB,UAAU,IAAI,IAAI,EAAE;QAC1B,MAAM,IAAI/B,kBAAkB,6EAAAmB,MAAA,CAE1BF,WAAW,GAAID,GAAG,CAAC;MACzB;MACA,IAAI,CAACgB,OAAO,GAAGjB,KAAK,CAACa,cAAc;IACvC,CAAC,MAAM;MACH,IAAIb,KAAK,CAACgB,UAAU,IAAI,IAAI,EAAE;QAC1B,MAAM,IAAI/B,kBAAkB,qEAAAmB,MAAA,CAE1BF,WAAW,GAAID,GAAG,CAAC;MACzB;MACA,IAAI,OAAOD,KAAK,CAACgB,UAAU,KAAK,QAAQ,IACpC,CAACF,MAAM,CAACC,QAAQ,CAACf,KAAK,CAACgB,UAAU,CAAC,EAAE;QACpC,MAAM,IAAI/B,kBAAkB,iDAAAmB,MAAA,CAC1BF,WAAW,QAAAE,MAAA,CAAKJ,KAAK,CAACgB,UAAU,GAAIf,GAAG,CAAC;MAC9C;MACA,IAAI,CAACiB,OAAO,GAAGlB,KAAK,CAACgB,UAAU;IACnC;IACA,IAAIhB,KAAK,CAACmB,UAAU,IAAI,IAAI,EAAE;MAC1B,IAAI,OAAOnB,KAAK,CAACmB,UAAU,KAAK,QAAQ,IACpC,CAACL,MAAM,CAACC,QAAQ,CAACf,KAAK,CAACmB,UAAU,CAAC,EAAE;QACpC,MAAM,IAAIlC,kBAAkB,iDAAAmB,MAAA,CAE1CF,WAAW,QAAAE,MAAA,CAAKJ,KAAK,CAACmB,UAAU,GAAIlB,GAAG,CAAC;MAC9B;MACA,IAAI,CAACmB,WAAW,GAAGpB,KAAK,CAACmB,UAAU;IACvC;EACJ;EAEAE,kBAAkBA,CAACC,OAAO,EAAErB,GAAG,EAAE;IAC7BzB,MAAM,CAAC8C,OAAO,IAAI,IAAI,IAAIA,OAAO,CAACC,aAAa,CAAC;IAEhD,IAAI,CAACD,OAAO,CAAChC,YAAY,CAAC,EAAE;MACxB,MAAM,IAAIL,kBAAkB,gCAAAmB,MAAA,CACMd,YAAY,YAAAc,MAAA,CACxDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACd,KAAK,CAACkB,WAAW,CAACiB,OAAO,CAAChC,YAAY,CAAC,CAAC,EAAE;MAC3C,MAAM,IAAIL,kBAAkB,eAAAmB,MAAA,CACXd,YAAY,YAAAc,MAAA,CAAQkB,OAAO,CAACC,aAAa,4BAAAnB,MAAA,CAClDkB,OAAO,CAAChC,YAAY,CAAC,GAAIW,GAAG,CAAC;IACzC;IACA,IAAI,CAACK,SAAS,GAAGgB,OAAO,CAAChC,YAAY,CAAC;IAEtC,IAAI,CAACgC,OAAO,CAAC/B,SAAS,CAAC,EAAE;MACrB,MAAM,IAAIN,kBAAkB,gCAAAmB,MAAA,CACMb,SAAS,YAAAa,MAAA,CACrDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACd,KAAK,CAACkB,WAAW,CAACiB,OAAO,CAAC/B,SAAS,CAAC,CAAC,EAAE;MACxC,MAAM,IAAIN,kBAAkB,eAAAmB,MAAA,CACXb,SAAS,cAAAa,MAAA,CAASkB,OAAO,CAACC,aAAa,8BAAAnB,MAAA,CAChDkB,OAAO,CAAC/B,SAAS,CAAC,GAAIU,GAAG,CAAC;IACtC;IACA,IAAI,CAACO,OAAO,GAAGc,OAAO,CAAC/B,SAAS,CAAC;IAEjC,IAAI,CAAC+B,OAAO,CAACjC,gBAAgB,CAAC,EAAE;MAC5B,MAAM,IAAIJ,kBAAkB,gCAAAmB,MAAA,CACMZ,aAAa,YAAAY,MAAA,CACzDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACU,YAAY,GAAGW,OAAO,CAACjC,gBAAgB,CAAC;IAE7C,IAAI,CAACuB,MAAM,MAAAR,MAAA,CACJ,IAAI,CAACE,SAAS,OAAAF,MAAA,CAAI,IAAI,CAACI,OAAO,OAAAJ,MAAA,CAAI,IAAI,CAACO,YAAY,CAAE;IAE5D,IAAI,CAACW,OAAO,CAAC9B,aAAa,CAAC,EAAE;MACzB,MAAM,IAAIP,kBAAkB,gCAAAmB,MAAA,CACMZ,aAAa,YAAAY,MAAA,CACzDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACgB,OAAO,GAAGK,OAAO,CAAC9B,aAAa,CAAC;IAErC,IAAI8B,OAAO,CAAC7B,eAAe,CAAC,EAAE;MAC1B,IAAI,CAAC2B,WAAW,GAAGE,OAAO,CAAC7B,eAAe,CAAC;IAC/C;EACJ;EAEA+B,WAAWA,CAACxB,KAAK,EAAEC,GAAG,EAAE;IACpB,IAAID,KAAK,CAACuB,aAAa,EAAE;MACrB,IAAI,CAACF,kBAAkB,CAACrB,KAAK,EAAEC,GAAG,CAAC;IACvC,CAAC,MAAM;MACH,IAAI,CAACF,cAAc,CAACC,KAAK,EAAEC,GAAG,EAAED,KAAK,CAACyB,kBAAkB,GACpD5B,oBAAoB,GAAGD,eAAe,CAAC;IAC/C;EACJ;EAEA,MAAM8B,eAAeA,CAAA,EAAG;IACpB,IAAI,IAAI,CAACT,OAAO,IAAI,IAAI,EAAE;MACtB,IAAI,CAACU,WAAW,GAAG,MAAMxC,KAAK,CAACyC,qBAAqB,CAAC,IAAI,CAACX,OAAO,EAC7D,IAAI,CAACG,WAAW,CAAC;IACzB,CAAC,MAAM;MACH,IAAI,CAACO,WAAW,GAAGxC,KAAK,CAAC0C,iBAAiB,CAAC,IAAI,CAACX,OAAO,EACnD,IAAI,CAACE,WAAW,CAAC;IACzB;EACJ;EAEA,MAAMU,UAAUA,CAAA,EAAG;IACf,IAAI,IAAI,CAACH,WAAW,IAAI,IAAI,EAAE;MAC1B,MAAM,IAAI,CAACD,eAAe,CAAC,CAAC;IAChC;IACA,OAAO;MACHK,KAAK,EAAE,IAAI,CAACnB,MAAM;MAClBI,UAAU,EAAE,IAAI,CAACW,WAAW;MAC5BxB,QAAQ,EAAE,IAAI,CAACG;IACnB,CAAC;EACL;EAEA0B,KAAKA,CAAA,EAAG;IACJ;IACA;IACAlD,SAAS,CAAC,IAAI,CAACmD,UAAU,CAAC;EAC9B;AAEJ;AAEA,MAAMC,wBAAwB,CAAC;EAE3BV,WAAWA,CAACF,OAAO,EAAErB,GAAG,EAAE;IACtBzB,MAAM,CAAC8C,OAAO,IAAI,IAAI,IAAIA,OAAO,CAACC,aAAa,CAAC;IAEhD,IAAI,CAACD,OAAO,CAAChC,YAAY,CAAC,EAAE;MACxB,MAAM,IAAIL,kBAAkB,gCAAAmB,MAAA,CACMd,YAAY,YAAAc,MAAA,CACxDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACd,KAAK,CAACkB,WAAW,CAACiB,OAAO,CAAChC,YAAY,CAAC,CAAC,EAAE;MAC3C,MAAM,IAAIL,kBAAkB,eAAAmB,MAAA,CACXd,YAAY,YAAAc,MAAA,CAAQkB,OAAO,CAACC,aAAa,4BAAAnB,MAAA,CAClDkB,OAAO,CAAChC,YAAY,CAAC,GAAIW,GAAG,CAAC;IACzC;IACA,IAAI,CAACK,SAAS,GAAGgB,OAAO,CAAChC,YAAY,CAAC;IAEtC,IAAI,CAACgC,OAAO,CAAC9B,aAAa,CAAC,EAAE;MACzB,MAAM,IAAIP,kBAAkB,gCAAAmB,MAAA,CACMZ,aAAa,YAAAY,MAAA,CACzDkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACgB,OAAO,GAAGK,OAAO,CAAC9B,aAAa,CAAC;IAErC,IAAI8B,OAAO,CAAC7B,eAAe,CAAC,EAAE;MAC1B,IAAI,CAAC2B,WAAW,GAAGE,OAAO,CAAC7B,eAAe,CAAC;IAC/C;IAEA,IAAI,CAAC6B,OAAO,CAAC3B,oBAAoB,CAAC,EAAE;MAChC,MAAM,IAAIV,kBAAkB,gCAAAmB,MAAA,CACMT,oBAAoB,YAAAS,MAAA,CAChEkB,OAAO,CAACC,aAAa,GAAItB,GAAG,CAAC;IACvB;IACA,IAAI,CAACkC,cAAc,GAAGb,OAAO,CAAC3B,oBAAoB,CAAC;EACvD;EAEA,MAAM+B,eAAeA,CAAA,EAAG;IACpB,IAAI,IAAI,CAACT,OAAO,IAAI,IAAI,EAAE;MACtB,IAAI,CAACU,WAAW,GAAG,MAAMxC,KAAK,CAACyC,qBAAqB,CAAC,IAAI,CAACX,OAAO,EAC7D,IAAI,CAACG,WAAW,CAAC;IACzB,CAAC,MAAM;MACH,IAAI,CAACO,WAAW,GAAGxC,KAAK,CAAC0C,iBAAiB,CAAC,IAAI,CAACX,OAAO,EACnD,IAAI,CAACE,WAAW,CAAC;IACzB;EACJ;EAEA,MAAMgB,cAAcA,CAAA,EAAG;IACnB,IAAIC,IAAI;IACR,IAAI;MACAA,IAAI,GAAG,MAAMzD,UAAU,CAAC0D,QAAQ,CAAC,IAAI,CAACH,cAAc,EAAE,MAAM,CAAC;IACjE,CAAC,CAAC,OAAMI,GAAG,EAAE;MACT,MAAMrD,uBAAuB,CAACsD,UAAU,8CAAApC,MAAA,CAElD,IAAI,CAAC+B,cAAc,QAAA/B,MAAA,CAAKmC,GAAG,CAACE,OAAO,GAAIF,GAAG,CAAC;IACrC;IACAF,IAAI,GAAGA,IAAI,CAACK,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC;IACjC,IAAI,CAACL,IAAI,EAAE;MACP,MAAMnD,uBAAuB,CAACsD,UAAU,6BAAApC,MAAA,CACR,IAAI,CAAC+B,cAAc,cAAW,CAAC;IACnE;IACA,OAAOE,IAAI;EACf;EAEA,MAAMP,UAAUA,CAAA,EAAG;IACf,IAAI,IAAI,CAACH,WAAW,IAAI,IAAI,EAAE;MAC1B,MAAM,IAAI,CAACD,eAAe,CAAC,CAAC;IAChC;IACA,MAAMiB,KAAK,GAAG,MAAM,IAAI,CAACP,cAAc,CAAC,CAAC;IACzC,OAAO;MACHL,KAAK,EAAE,KAAK,GAAGY,KAAK;MACpB3B,UAAU,EAAE,IAAI,CAACW,WAAW;MAC5BxB,QAAQ,EAAE,IAAI,CAACG;IACnB,CAAC;EACL;EAEA0B,KAAKA,CAAA,EAAG;IACJlD,SAAS,CAAC,IAAI,CAACmD,UAAU,CAAC;EAC9B;AAEJ;AAEA,MAAMW,qBAAqB,CAAC;EAExBpB,WAAWA,CAACqB,GAAG,EAAE5C,GAAG,EAAqC;IAAA,IAAnC6C,YAAY,GAAAC,SAAA,CAAArC,MAAA,QAAAqC,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAGjD,kBAAkB;IACnDtB,MAAM,CAACqE,GAAG,IAAI,IAAI,CAAC;IACnB,IAAII,UAAU;IACd,IAAIC,WAAW;IAEf,IAAIL,GAAG,CAACI,UAAU,IAAI,IAAI,EAAE;MACxB,IAAI,OAAOJ,GAAG,CAACI,UAAU,KAAK,QAAQ,IAClC,CAACnC,MAAM,CAACC,QAAQ,CAAC8B,GAAG,CAACI,UAAU,CAAC,EAAE;QAClC,MAAM,IAAIhE,kBAAkB,2CAAAmB,MAAA,CACrByC,GAAG,CAACI,UAAU,GAAIhD,GAAG,CAAC;MACjC;MACAgD,UAAU,GAAGJ,GAAG,CAACI,UAAU;IAC/B,CAAC,MAAM;MACHA,UAAU,GAAGtE,IAAI,CAACwE,IAAI,CAACzE,EAAE,CAAC0E,OAAO,CAAC,CAAC,EAAE,MAAM,EAAE,QAAQ,CAAC;IAC1D;IACA,IAAIP,GAAG,CAACK,WAAW,IAAI,IAAI,EAAE;MACzB,IAAI,OAAOL,GAAG,CAACK,WAAW,KAAK,QAAQ,EAAE;QACrC,MAAM,IAAIjE,kBAAkB,4CAAAmB,MAAA,CACpByC,GAAG,CAACK,WAAW,GAAIjD,GAAG,CAAC;MACnC;MACAiD,WAAW,GAAGL,GAAG,CAACK,WAAW;IACjC,CAAC,MAAM;MACHA,WAAW,GAAG9D,oBAAoB;IACtC;IAEAZ,MAAM,CAACsE,YAAY,IAAI,IAAI,CAAC;IAC5B,IAAI,CAACO,aAAa,GAAGP,YAAY;;IAEjC;IACA,MAAMxB,OAAO,GAAG,IAAI,CAACgC,eAAe,CAACL,UAAU,EAAEC,WAAW,EAAEjD,GAAG,CAAC;IAClE,IAAI,CAACsD,SAAS,GAAG,IAAIT,YAAY,CAACxB,OAAO,EAAErB,GAAG,CAAC;IAC/C,IAAIqB,OAAO,CAAC5B,WAAW,CAAC,EAAE;MACtB,IAAI,CAAC8D,OAAO,GAAGlC,OAAO,CAAC5B,WAAW,CAAC;IACvC;EACJ;EAEA4D,eAAeA,CAACL,UAAU,EAAEC,WAAW,EAAEjD,GAAG,EAAE;IAC1C,IAAIqB,OAAO;IACX,IAAI;MACAA,OAAO,GAAGvC,eAAe,CAACkE,UAAU,EAAEC,WAAW,CAAC;IACtD,CAAC,CAAC,OAAMX,GAAG,EAAE;MACT,MAAMrD,uBAAuB,CAACsD,UAAU,6BAAApC,MAAA,CAC1C8C,WAAW,wBAAA9C,MAAA,CAAqB6C,UAAU,GAAIV,GAAG,EAAEtC,GAAG,CAAC;IACzD;IACA,IAAIqB,OAAO,IAAI,IAAI,EAAE;MACjB,MAAMpC,uBAAuB,CAACsD,UAAU,0BAAApC,MAAA,CACjD8C,WAAW,wBAAA9C,MAAA,CAAoB6C,UAAU,GAAI,IAAI,EAAEhD,GAAG,CAAC;IAClD;IAEAqB,OAAO,CAACC,aAAa,wBAAAnB,MAAA,CAAuB6C,UAAU,oBAAA7C,MAAA,CACnD8C,WAAW,OAAG;IACjB,OAAO5B,OAAO;EAClB;EAEAQ,UAAUA,CAAA,EAAG;IACTtD,MAAM,CAAC,IAAI,CAAC+E,SAAS,IAAI,IAAI,CAAC;IAC9B,OAAO,IAAI,CAACA,SAAS,CAACzB,UAAU,CAAC,CAAC;EACtC;EAEA2B,SAASA,CAAA,EAAG;IACR,OAAO,IAAI,CAACD,OAAO;EACvB;EAEAxB,KAAKA,CAAA,EAAG;IACJ,IAAI,IAAI,CAACuB,SAAS,IAAI,IAAI,EAAE;MACxB,IAAI,CAACA,SAAS,CAACvB,KAAK,CAAC,CAAC;IAC1B;EACJ;AACJ;AAEA,MAAM0B,mBAAmB,CAAC;EAEtBlC,WAAWA,CAACqB,GAAG,EAAE5C,GAAG,EAAE;IAClBzB,MAAM,CAAEqE,GAAG,IAAI,IAAI,IAAI,qBAAqB,IAAIA,GAAG,CAAC;IACpD,IAAIc,aAAa,GAAGd,GAAG,CAACe,mBAAmB;IAC3C,IAAI,OAAOD,aAAa,KAAK,QAAQ,EAAE;MACnC,IAAI;QACAA,aAAa,GAAG3E,WAAW,CAAC2E,aAAa,CAAC;MAC9C,CAAC,CAAC,OAAMpB,GAAG,EAAE;QACT,MAAM,IAAItD,kBAAkB,qDAAAmB,MAAA,CACpBuD,aAAa,SAAK1D,GAAG,EAAEsC,GAAG,CAAC;MACvC;IACJ;IACA,IAAI,OAAOoB,aAAa,KAAK,QAAQ,IAAIA,aAAa,IAAI,IAAI,EAAE;MAC5D,IAAI,OAAOA,aAAa,CAACE,eAAe,KAAK,UAAU,EAAE;QACrD,MAAM,IAAI5E,kBAAkB,CAAC;AAC7C,sEAAsE,EAAEgB,GAAG,CAAC;MAChE;MACA,IAAI,CAAC6D,cAAc,GAAGH,aAAa;IACvC,CAAC,MAAM,IAAI,OAAOA,aAAa,KAAK,UAAU,EAAE;MAC5C,IAAI,CAACG,cAAc,GAAG;QAAED,eAAe,EAAEF;MAAc,CAAC;IAC5D,CAAC,MAAM;MACH,MAAM,IAAI1E,kBAAkB,mDAAAmB,MAAA,CACRuD,aAAa,GAAI1D,GAAG,CAAC;IAC7C;EACJ;EAEA,MAAM6B,UAAUA,CAAA,EAAG;IACf,IAAI9B,KAAK;IACT,IAAI;MACAA,KAAK,GAAG,MAAM,IAAI,CAAC8D,cAAc,CAACD,eAAe,CAAC,CAAC;IACvD,CAAC,CAAC,OAAMtB,GAAG,EAAE;MACT,MAAMrD,uBAAuB,CAACsD,UAAU,CAAC;AACrD,YAAY,EAAED,GAAG,CAAC;IACV;IACA,IAAIvC,KAAK,IAAI,IAAI,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;MAC5C,MAAMd,uBAAuB,CAACsD,UAAU,CAAC;AACrD,uBAAuB,CAAC;IAChB;IACAxC,KAAK,CAACyB,kBAAkB,GAAG,IAAI;IAE/B,IAAIsC,QAAQ;IACZ,IAAI;MACAA,QAAQ,GAAG,IAAIjE,kBAAkB,CAACE,KAAK,CAAC;MACxC,OAAO+D,QAAQ,CAACjC,UAAU,CAAC,CAAC;IAChC,CAAC,SAAS;MACN,IAAIiC,QAAQ,IAAI,IAAI,EAAE;QAClBA,QAAQ,CAAC/B,KAAK,CAAC,CAAC;MACpB;IACJ;EACJ;AAEJ;AAEAgC,MAAM,CAACC,OAAO,GAAG;EACbnE,kBAAkB;EAClBoC,wBAAwB;EACxBU,qBAAqB;EACrBc;AACJ,CAAC","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}